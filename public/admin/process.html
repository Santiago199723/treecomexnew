<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tela de cadastro de processos</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/admin.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autonumeric/4.10.5/autoNumeric.js"></script>
  </head>
  <body>
    <div class="container">
      <div style="position: absolute; bottom: 0; left: 0">
        <button
          style="
            background-color: transparent;
            align-items: center;
            display: inline-flex;
            color: #fcfcfc;
            background: none;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.5s;
            letter-spacing: 4px;
          "
          onclick="routeTo('/admin/index.html')"
        >
          <image style="width: 26px" src="/assets/voltar.png"></image>
        </button>
      </div>
      <h2>CADASTRO DE PROCESSO</h2>
      <form id="form">
        <input type="text" id="process-id" placeholder="Informe o processo" />
        <input
          type="text"
          id="process-company"
          placeholder="Informe o CPF ou CNPJ"
        />
        <input type="text" id="client" placeholder="Cliente" />

        <div class="reais-container">
          <div class="reais-box">
            <p>R$</p>
          </div>
          <input type="numeric" id="forecast" placeholder="PrevisÃ£o de Gasto" />
        </div>

        <button type="submit" class="btn">Cadastrar Processo</button>
      </form>
    </div>

    <script>
      new AutoNumeric("#forecast", {
        digitGroupSeparator: ",",
        decimalCharacter: ".",
        decimalPlaces: 2,
        unformatOnSubmit: false,
      });

      document
        .getElementById("form")
        .addEventListener("submit", async function (event) {
          event.preventDefault();
          const processId = document.getElementById("process-id").value;
          const company = document.getElementById("process-company").value;
          const client = document.getElementById("client").value;
          const forecast = document.getElementById("forecast").value;

          if (!processId && !company) {
            alert("Por favor, preencha todos os campos.");
            return;
          }

          const response = await fetch("/process", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              id: processId,
              company: company,
              client: client,
              forecast: forecast,
            }),
            credentials: "include",
          });

          if (response.ok) document.getElementById("form").reset();

          const data = await response.json();
          alert(data.message || data.error);
        });
    </script>
    <script src="/scripts/utils.js"></script>
    <script src="js/session.js"></script>
  </body>
</html>
